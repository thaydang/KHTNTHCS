name: AI Exam Machine

# PHẦN 1: Cấu hình sự kiện (Giữ nguyên tiếng Anh 'on', 'inputs')
on:
  workflow_dispatch:
    inputs:
      bai_hoc:
        description: 'Tên bài học (VD: Oxy, Lực đẩy Archimedes)'
        required: true
        default: 'Bai_Tap_KHTN'
      so_cau:
        description: 'Số lượng câu hỏi'
        required: true
        default: '10'
        type: choice
        options:
        - '5'
        - '10'
        - '15'
        - '20'
        - '25'
        - '50'
# PHẦN 2: Các công việc cần làm (Giữ nguyên 'jobs', 'steps', 'run')
jobs:
  generate:
    runs-on: ubuntu-latest
    
    steps:
    # 1. Lấy code về
    - uses: actions/checkout@v4

    # 2. Cài đặt Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    # 3. Cài công cụ hỗ trợ xuất file (Không được dịch lệnh 'sudo apt-get...')
    - name: Install System Tools
      run: |
        sudo apt-get update
        sudo apt-get install -y pandoc libcairo2-dev

    # 4. Cài thư viện Python
    - name: Install Libraries
      run: pip install -r requirements.txt

    # 5. CHẠY MÁY (Gọi file Python)
    - name: Run Generator
      env:
        GEMINI_API_KEY: ${{ secrets.GEMINI_API_KEY }}
        INPUT_TOPIC: ${{ inputs.bai_hoc }}
        INPUT_NUM: ${{ inputs.so_cau }}
      run: python gen_exam.py

    # 6. Trả hàng (Upload file kết quả)
    - name: Upload Result
      uses: actions/upload-artifact@v4
      with:
        name: Ket-qua-thi
        path: output/
